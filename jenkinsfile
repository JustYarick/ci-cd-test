pipeline {
    agent {
        kubernetes {
            defaultContainer 'docker'
            yamlFile 'agentpod.yaml'
        }
    }
    
    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        
        stage('Build Docker Image') {
            steps {
                container('docker') {
                    sh '''
                        docker build -t yaricks/ci-cd-test:latest .
                        docker tag yaricks/ci-cd-test:latest yaricks/ci-cd-test:${BUILD_NUMBER}
                    '''
                }
            }
        }
    }
}
